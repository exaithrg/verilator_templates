<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulating (Verilated-Model Runtime) &mdash; Verilator 4.210 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/vlt_sphinx.css" type="text/css" />
    <link rel="shortcut icon" href="_static/verilator_32x32_min.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="next" title="Contributing and Reporting Bugs" href="contributing.html" />
    <link rel="prev" title="Connecting to Verilated Models" href="connecting.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #45acf8" >
            <a href="index.html">
            <img src="_static/verilator_192_150_min.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                4.210
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User's Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="verilating.html">Verilating</a></li>
<li class="toctree-l1"><a class="reference internal" href="connecting.html">Connecting to Verilated Models</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Simulating (Verilated-Model Runtime)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#benchmarking-optimization">Benchmarking &amp; Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#coverage-analysis">Coverage Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#functional-coverage">Functional Coverage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#line-coverage">Line Coverage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#toggle-coverage">Toggle Coverage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#coverage-collection">Coverage Collection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#code-profiling">Code Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#thread-profiling">Thread Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#profiling-ccache-efficiency">Profiling ccache efficiency</a></li>
<li class="toctree-l2"><a class="reference internal" href="#save-restore">Save/Restore</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing and Reporting Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ/Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="languages.html">Input Languages</a></li>
<li class="toctree-l1"><a class="reference internal" href="extensions.html">Language Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="executables.html">Executable and Argument Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="warnings.html">Errors and Warnings</a></li>
<li class="toctree-l1"><a class="reference internal" href="files.html">Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="deprecations.html">Deprecations</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributors.html">Contributors and Origins</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">Revision History</a></li>
<li class="toctree-l1"><a class="reference internal" href="copyright.html">Copyright</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #45acf8" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Verilator</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Simulating (Verilated-Model Runtime)</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/verilator/verilator/blob/master/docs/guide/simulating.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="simulating-verilated-model-runtime">
<span id="simulating"></span><h1>Simulating (Verilated-Model Runtime)<a class="headerlink" href="#simulating-verilated-model-runtime" title="Permalink to this heading">¶</a></h1>
<p>This section describes items related to simulating, that using a Verilated
model’s executable.  For the runtime arguments to a simulated model, see
<a class="reference internal" href="exe_sim.html#simulation-runtime-arguments"><span class="std std-ref">Simulation Runtime Arguments</span></a>.</p>
<section id="benchmarking-optimization">
<span id="id1"></span><h2>Benchmarking &amp; Optimization<a class="headerlink" href="#benchmarking-optimization" title="Permalink to this heading">¶</a></h2>
<p>For best performance, run Verilator with the <a class="reference internal" href="exe_verilator.html#cmdoption-O3"><code class="xref std std-option docutils literal notranslate"><span class="pre">-O3</span></code></a>
<a class="reference internal" href="exe_verilator.html#cmdoption-7"><code class="xref std std-option docutils literal notranslate"><span class="pre">--x-assign</span> <span class="pre">fast</span></code></a> <a class="reference internal" href="exe_verilator.html#cmdoption-9"><code class="xref std std-option docutils literal notranslate"><span class="pre">--x-initial</span> <span class="pre">fast</span></code></a> <a class="reference internal" href="exe_verilator.html#cmdoption-assert"><code class="xref std std-option docutils literal notranslate"><span class="pre">--noassert</span></code></a> options.  The <a class="reference internal" href="exe_verilator.html#cmdoption-O3"><code class="xref std std-option docutils literal notranslate"><span class="pre">-O3</span></code></a>
option will require longer time to run Verilator, and <a class="reference internal" href="exe_verilator.html#cmdoption-7"><code class="xref std std-option docutils literal notranslate"><span class="pre">--x-assign</span>
<span class="pre">fast</span></code></a> <a class="reference internal" href="exe_verilator.html#cmdoption-7"><code class="xref std std-option docutils literal notranslate"><span class="pre">--x-initial</span> <span class="pre">fast</span></code></a> may increase the
risk of reset bugs in trade for performance; see the above documentation
for these options.</p>
<p>If using Verilated multithreaded, use <code class="docutils literal notranslate"><span class="pre">numactl</span></code> to ensure you are using
non-conflicting hardware resources. See <a class="reference internal" href="verilating.html#multithreading"><span class="std std-ref">Multithreading</span></a>.</p>
<p>Minor Verilog code changes can also give big wins.  You should not have any
UNOPTFLAT warnings from Verilator.  Fixing these warnings can result in
huge improvements; one user fixed their one UNOPTFLAT warning by making a
simple change to a clock latch used to gate clocks and gained a 60%
performance improvement.</p>
<p>Beyond that, the performance of a Verilated model depends mostly on your
C++ compiler and size of your CPU’s caches. Experience shows that large
models are often limited by the size of the instruction cache, and as such
reducing code size if possible can be beneficial.</p>
<p>The supplied $VERILATOR_ROOT/include/verilated.mk file uses the OPT,
OPT_FAST, OPT_SLOW and OPT_GLOBAL variables to control optimization. You
can set these when compiling the output of Verilator with Make, for
example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make <span class="nv">OPT_FAST</span><span class="o">=</span><span class="s2">&quot;-Os -march=native&quot;</span> -f Vour.mk Vour__ALL.a
</pre></div>
</div>
<p>OPT_FAST specifies optimization options for those parts of the model that
are on the fast path. This is mostly code that is executed every
cycle. OPT_SLOW applies to slow-path code, which executes rarely, often
only once at the beginning or end of simulation. Note that OPT_SLOW is
ignored if VM_PARALLEL_BUILDS is not 1, in which case all generated code
will be compiled in a single compilation unit using OPT_FAST. See also the
Verilator <a class="reference internal" href="exe_verilator.html#cmdoption-output-split"><code class="xref std std-option docutils literal notranslate"><span class="pre">--output-split</span></code></a> option. The OPT_GLOBAL variable applies
to common code in the runtime library used by Verilated models (shipped in
$VERILATOR_ROOT/include). Additional C++ files passed on the verilator
command line use OPT_FAST. The OPT variable applies to all compilation
units in addition to the specific “OPT” variables described above.</p>
<p>You can also use the <a class="reference internal" href="exe_verilator.html#cmdoption-CFLAGS"><code class="xref std std-option docutils literal notranslate"><span class="pre">-CFLAGS</span></code></a> and/or <a class="reference internal" href="exe_verilator.html#cmdoption-LDFLAGS"><code class="xref std std-option docutils literal notranslate"><span class="pre">-LDFLAGS</span></code></a> options on
the verilator command line to pass arguments directly to the compiler or
linker.</p>
<p>The default values of the “OPT” variables are chosen to yield good
simulation speed with reasonable C++ compilation times. To this end,
OPT_FAST is set to “-Os” by default. Higher optimization such as “-O2” or
“-O3” may help (though often they provide only a very small performance
benefit), but compile times may be excessively large even with medium sized
designs. Compilation times can be improved at the expense of simulation
speed by reducing optimization, for example with OPT_FAST=”-O0”. Often good
simulation speed can be achieved with OPT_FAST=”-O1 -fstrict-aliasing” but
with improved compilation times. Files controlled by OPT_SLOW have little
effect on performance and therefore OPT_SLOW is empty by default
(equivalent to “-O0”) for improved compilation speed. In common use-cases
there should be little benefit in changing OPT_SLOW.  OPT_GLOBAL is set to
“-Os” by default and there should rarely be a need to change it. As the
runtime library is small in comparison to a lot of Verilated models,
disabling optimization on the runtime library should not have a serious
effect on overall compilation time, but may have detrimental effect on
simulation speed, especially with tracing. In addition to the above, for
best results use OPT=”-march=native”, the latest Clang compiler (about 10%
faster than GCC), and link statically.</p>
<p>Generally the answer to which optimization level gives the best user
experience depends on the use case and some experimentation can pay
dividends. For a speedy debug cycle during development, especially on large
designs where C++ compilation speed can dominate, consider using lower
optimization to get to an executable faster. For throughput oriented use
cases, for example regressions, it is usually worth spending extra
compilation time to reduce total CPU time.</p>
<p>If you will be running many simulations on a single model, you can
investigate profile guided optimization. With GCC, using GCC’s
“-fprofile-arcs”, then GCC’s “-fbranch-probabilities” will yield another
15% or so.</p>
<p>Modern compilers also support link-time optimization (LTO), which can help
especially if you link in DPI code. To enable LTO on GCC, pass “-flto” in
both compilation and link. Note LTO may cause excessive compile times on
large designs.</p>
<p>Unfortunately, using the optimizer with SystemC files can result in
compilation taking several minutes. (The SystemC libraries have many little
inlined functions that drive the compiler nuts.)</p>
<p>If you are using your own makefiles, you may want to compile the Verilated
code with <code class="docutils literal notranslate"><span class="pre">--MAKEFLAGS</span> <span class="pre">-DVL_INLINE_OPT=inline</span></code>. This will inline
functions, however this requires that all cpp files be compiled in a single
compiler run.</p>
<p>You may uncover further tuning possibilities by profiling the Verilog code.
See <a class="reference internal" href="#profiling"><span class="std std-ref">Code Profiling</span></a>.</p>
<p>When done optimizing, please let the author know the results.  We like to
keep tabs on how Verilator compares, and may be able to suggest additional
improvements.</p>
</section>
<section id="coverage-analysis">
<span id="id2"></span><h2>Coverage Analysis<a class="headerlink" href="#coverage-analysis" title="Permalink to this heading">¶</a></h2>
<p>Verilator supports adding code to the Verilated model to support
SystemVerilog code coverage.  With <a class="reference internal" href="exe_verilator.html#cmdoption-coverage"><code class="xref std std-option docutils literal notranslate"><span class="pre">--coverage</span></code></a>, Verilator enables
all forms of coverage:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#user-coverage"><span class="std std-ref">Functional Coverage</span></a></p></li>
<li><p><a class="reference internal" href="#line-coverage"><span class="std std-ref">Line Coverage</span></a></p></li>
<li><p><a class="reference internal" href="#toggle-coverage"><span class="std std-ref">Toggle Coverage</span></a></p></li>
</ul>
<p>When a model with coverage is executed, it will create a coverage file for
collection and later analysis, see <a class="reference internal" href="#coverage-collection"><span class="std std-ref">Coverage Collection</span></a>.</p>
<section id="functional-coverage">
<span id="user-coverage"></span><h3>Functional Coverage<a class="headerlink" href="#functional-coverage" title="Permalink to this heading">¶</a></h3>
<p>With <a class="reference internal" href="exe_verilator.html#cmdoption-coverage"><code class="xref std std-option docutils literal notranslate"><span class="pre">--coverage</span></code></a> or <a class="reference internal" href="exe_verilator.html#cmdoption-coverage-user"><code class="xref std std-option docutils literal notranslate"><span class="pre">--coverage-user</span></code></a>, Verilator will
translate functional coverage points which the user has inserted manually
into the SystemVerilog design, into the Verilated model.</p>
<p>Currently, all functional coverage points are specified using SystemVerilog
assertion syntax which must be separately enabled with <a class="reference internal" href="exe_verilator.html#cmdoption-assert"><code class="xref std std-option docutils literal notranslate"><span class="pre">--assert</span></code></a>.</p>
<p>For example, the following SystemVerilog statement will add a coverage
point, under the coverage name “DefaultClock”:</p>
<div class="highlight-sv notranslate"><div class="highlight"><pre><span></span><span class="nl">DefaultClock:</span><span class="w"> </span><span class="k">cover</span><span class="w"> </span><span class="k">property</span><span class="w"> </span><span class="p">(@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="p">)</span><span class="w"> </span><span class="n">cyc</span><span class="o">==</span><span class="mi">3</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="line-coverage">
<span id="id3"></span><h3>Line Coverage<a class="headerlink" href="#line-coverage" title="Permalink to this heading">¶</a></h3>
<p>With <a class="reference internal" href="exe_verilator.html#cmdoption-coverage"><code class="xref std std-option docutils literal notranslate"><span class="pre">--coverage</span></code></a> or <a class="reference internal" href="exe_verilator.html#cmdoption-coverage-line"><code class="xref std std-option docutils literal notranslate"><span class="pre">--coverage-line</span></code></a>, Verilator will
automatically add coverage analysis at each code flow change point (e.g. at
branches).  At each such branch a unique counter is incremented.  At the
end of a test, the counters along with the filename and line number
corresponding to each counter are written into the coverage file.</p>
<p>Verilator automatically disables coverage of branches that have a $stop in
them, as it is assumed $stop branches contain an error check that should
not occur.  A <a class="reference internal" href="extensions.html#cmdoption-verilator-32-coverage_block_off"><code class="xref std std-option docutils literal notranslate"><span class="pre">/*verilator&amp;32;coverage_block_off*/</span></code></a> metacomment
will perform a similar function on any code in that block or below, or
<a class="reference internal" href="extensions.html#cmdoption-verilator-32-coverage_off"><code class="xref std std-option docutils literal notranslate"><span class="pre">/*verilator&amp;32;coverage_off*/</span></code></a> and
<a class="reference internal" href="extensions.html#cmdoption-verilator-32-coverage_on"><code class="xref std std-option docutils literal notranslate"><span class="pre">/*verilator&amp;32;coverage_on*/</span></code></a> will disable and enable coverage
respectively around a block of code.</p>
<p>Verilator may over-count combinatorial (non-clocked) blocks when those
blocks receive signals which have had the UNOPTFLAT warning disabled; for
most accurate results do not disable this warning when using coverage.</p>
</section>
<section id="toggle-coverage">
<span id="id4"></span><h3>Toggle Coverage<a class="headerlink" href="#toggle-coverage" title="Permalink to this heading">¶</a></h3>
<p>With <a class="reference internal" href="exe_verilator.html#cmdoption-coverage"><code class="xref std std-option docutils literal notranslate"><span class="pre">--coverage</span></code></a> or <a class="reference internal" href="exe_verilator.html#cmdoption-coverage-toggle"><code class="xref std std-option docutils literal notranslate"><span class="pre">--coverage-toggle</span></code></a>, Verilator will
automatically add toggle coverage analysis  into the Verilated model.</p>
<p>Every bit of every signal in a module has a counter inserted.  The counter
will increment on every edge change of the corresponding bit.</p>
<p>Signals that are part of tasks or begin/end blocks are considered local
variables and are not covered.  Signals that begin with underscores (see
<a class="reference internal" href="exe_verilator.html#cmdoption-coverage-underscore"><code class="xref std std-option docutils literal notranslate"><span class="pre">--coverage-underscore</span></code></a>), are integers, or are very wide (&gt;256 bits
total storage across all dimensions, see <a class="reference internal" href="exe_verilator.html#cmdoption-coverage-max-width"><code class="xref std std-option docutils literal notranslate"><span class="pre">--coverage-max-width</span></code></a>) are
also not covered.</p>
<p>Hierarchy is compressed, such that if a module is instantiated multiple
times, coverage will be summed for that bit across <strong>all</strong> instantiations
of that module with the same parameter set.  A module instantiated with
different parameter values is considered a different module, and will get
counted separately.</p>
<p>Verilator makes a minimally-intelligent decision about what clock domain
the signal goes to, and only looks for edges in that clock domain.  This
means that edges may be ignored if it is known that the edge could never be
seen by the receiving logic.  This algorithm may improve in the future.
The net result is coverage may be lower than what would be seen by looking
at traces, but the coverage is a more accurate representation of the
quality of stimulus into the design.</p>
<p>There may be edges counted near time zero while the model stabilizes.  It’s
a good practice to zero all coverage just before releasing reset to prevent
counting such behavior.</p>
<p>A <a class="reference internal" href="extensions.html#cmdoption-verilator-32-coverage_off"><code class="xref std std-option docutils literal notranslate"><span class="pre">/*verilator&amp;32;coverage_off*/</span></code></a>
<a class="reference internal" href="extensions.html#cmdoption-verilator-32-coverage_on"><code class="xref std std-option docutils literal notranslate"><span class="pre">/*verilator&amp;32;coverage_on*/</span></code></a> metacomment pair can be used around
signals that do not need toggle analysis, such as RAMs and register files.</p>
</section>
<section id="coverage-collection">
<span id="id5"></span><h3>Coverage Collection<a class="headerlink" href="#coverage-collection" title="Permalink to this heading">¶</a></h3>
<p>When any coverage flag was used to Verilate, Verilator will add appropriate
coverage point insertions into the model and collect the coverage data.</p>
<p>To get the coverage data from the model, in the user wrapper code,
typically at the end once a test passes, call
<code class="code docutils literal notranslate"><span class="pre">Verilated::coveragep()-&gt;write</span></code> with an argument of the filename for
the coverage data file to write coverage data to (typically
“logs/coverage.dat”).</p>
<p>Run each of your tests in different directories, potentially in parallel.
Each test will create a <code class="file docutils literal notranslate"><span class="pre">logs/coverage.dat</span></code> file.</p>
<p>After running all of the tests, execute the <strong class="command">verilator_coverage</strong>
command, passing arguments pointing to the filenames of all of the
individual coverage files.  <strong class="command">verilator_coverage</strong> will reads the
<code class="file docutils literal notranslate"><span class="pre">logs/coverage.dat</span></code> file(s), and create an annotated source code
listing showing code coverage details.</p>
<p><strong class="command">verilator_coverage</strong> may also be used for test grading, that is
computing which tests are important to fully cover the design.</p>
<p>For an example, see the <code class="file docutils literal notranslate"><span class="pre">examples/make_tracing_c/logs</span></code> directory.
Grep for lines starting with ‘%’ to see what lines Verilator believes need
more coverage.</p>
<p>Additional options of <strong class="command">verilator_coverage</strong> allow for merging of
coverage data files or other transformations.</p>
<p>Info files can be written by verilator_coverage for import to
<strong class="command">lcov</strong>.  This enables use of <strong class="command">genhtml</strong> for HTML reports
and importing reports to sites such as <a class="reference external" href="https://codecov.io">https://codecov.io</a>.</p>
</section>
</section>
<section id="code-profiling">
<span id="profiling"></span><h2>Code Profiling<a class="headerlink" href="#code-profiling" title="Permalink to this heading">¶</a></h2>
<p>The Verilated model may be code-profiled using GCC or Clang’s C++ profiling
mechanism.  Verilator provides additional flags to help map the resulting
C++ profiling results back to the original Verilog code responsible for the
profiled C++ code functions.</p>
<p>To use profiling:</p>
<ol class="arabic simple">
<li><p>Use Verilator’s <a class="reference internal" href="exe_verilator.html#cmdoption-prof-cfuncs"><code class="xref std std-option docutils literal notranslate"><span class="pre">--prof-cfuncs</span></code></a>.</p></li>
<li><p>Build and run the simulation model.</p></li>
<li><p>The model will create gmon.out.</p></li>
<li><p>Run <strong class="command">gprof</strong> to see where in the C++ code the time is spent.</p></li>
<li><p>Run the gprof output through the <strong class="command">verilator_profcfunc</strong> program
and it will tell you what Verilog line numbers on which most of the time
is being spent.</p></li>
</ol>
</section>
<section id="thread-profiling">
<span id="id6"></span><h2>Thread Profiling<a class="headerlink" href="#thread-profiling" title="Permalink to this heading">¶</a></h2>
<p>When using multithreaded mode (<a class="reference internal" href="exe_verilator.html#cmdoption-threads"><code class="xref std std-option docutils literal notranslate"><span class="pre">--threads</span></code></a>), it is useful to see
statistics and visualize how well the multiple CPUs are being utilized.</p>
<p>With the <a class="reference internal" href="exe_verilator.html#cmdoption-prof-threads"><code class="xref std std-option docutils literal notranslate"><span class="pre">--prof-threads</span></code></a> option, Verilator will:</p>
<ul class="simple">
<li><p>Add code to the Verilated model to record the start and end time of each
macro-task across a number of calls to eval. (What is a macro-task?  See
the Verilator internals document (<code class="file docutils literal notranslate"><span class="pre">docs/internals.rst</span></code> in the
distribution.)</p></li>
<li><p>Add code to save profiling data in non-human-friendly form to the file
specified with <a class="reference internal" href="exe_sim.html#cmdoption-arg-verilator-prof-threads-file-filename"><code class="xref std std-option docutils literal notranslate"><span class="pre">+verilator+prof+threads+file+&lt;filename&gt;</span></code></a>.</p></li>
</ul>
<p>The <strong class="command">verilator_gantt</strong> program may then be run to transform the
saved profiling file into a nicer visual format and produce some related
statistics.</p>
<figure class="align-default" id="id9">
<img alt="_images/fig_gantt_min.png" src="_images/fig_gantt_min.png" />
<figcaption>
<p><span class="caption-number">Fig. 1 </span><span class="caption-text">Example verilator_gantt output, as viewed with GTKWave.</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
<div class="legend">
<p>The parallelism shows the number of CPUs being used at a given moment.</p>
<p>The cpu_thread section shows which thread is executing on each of the physical CPUs.</p>
<p>The thread_mtask section shows which macro-task is running on a given thread.</p>
</div>
</figcaption>
</figure>
<p>For more information see <strong class="command">verilator_gantt</strong>.</p>
</section>
<section id="profiling-ccache-efficiency">
<span id="id7"></span><h2>Profiling ccache efficiency<a class="headerlink" href="#profiling-ccache-efficiency" title="Permalink to this heading">¶</a></h2>
<p>The Verilator generated Makefile provides support for basic profiling of
ccache behavior during the build. This can be used to track down files that
might be unnecessarily rebuilt, though as of today even small code changes
will usually require rebuilding a large number of files. Improving ccache
efficiency during the edit/compile/test loop is an active area of
development.</p>
<p>To get a basic report of how well ccache is doing, add the <cite>ccache-report</cite>
target when invoking the generated Makefile:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make -C obj_dir -f Vout.mk Vout ccache-report
</pre></div>
</div>
<p>This will print a report based on all executions of ccache during this
invocation of Make. The report is also written to a file, in this example
<cite>obj_dir/Vout__cache_report.txt</cite>.</p>
<p>To use the <cite>ccache-report</cite> target, at least one other explicit build target
must be specified, and OBJCACHE must be set to ‘ccache’.</p>
<p>This feature is currently experimental and might change in subsequent
releases.</p>
</section>
<section id="save-restore">
<span id="id8"></span><h2>Save/Restore<a class="headerlink" href="#save-restore" title="Permalink to this heading">¶</a></h2>
<p>The intermediate state of a Verilated model may be saved, so that it may
later be restored.</p>
<p>To enable this feature, use <a class="reference internal" href="exe_verilator.html#cmdoption-savable"><code class="xref std std-option docutils literal notranslate"><span class="pre">--savable</span></code></a>.  There are limitations in
what language features are supported along with <a class="reference internal" href="exe_verilator.html#cmdoption-savable"><code class="xref std std-option docutils literal notranslate"><span class="pre">--savable</span></code></a>; if you
attempt to use an unsupported feature Verilator will throw an error.</p>
<p>To use save/restore, the user wrapper code must create a VerilatedSerialize
or VerilatedDeserialze object then calling the <code class="code docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> or <code class="code docutils literal notranslate"><span class="pre">&gt;&gt;</span></code>
operators on the generated model and any other data the process needs
saved/restored.  These functions are not thread safe, and are typically
called only by a main thread.</p>
<p>For example:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">save_model</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">filenamep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">VerilatedSave</span><span class="w"> </span><span class="n">os</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">os</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">filenamep</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">os</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">main_time</span><span class="p">;</span><span class="w">  </span><span class="c1">// user code must save the timestamp, etc</span>
<span class="w">    </span><span class="n">os</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">topp</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">restore_model</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">filenamep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">VerilatedRestore</span><span class="w"> </span><span class="n">os</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">os</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">filenamep</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">os</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">main_time</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">os</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">*</span><span class="n">topp</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="connecting.html" class="btn btn-neutral float-left" title="Connecting to Verilated Models" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="contributing.html" class="btn btn-neutral float-right" title="Contributing and Reporting Bugs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="copyright.html">Copyright</a> 2021 by Wilson Snyder, under LGPL-3.0 or Artistic-2.0.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-D27B0C9QEB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-D27B0C9QEB', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>